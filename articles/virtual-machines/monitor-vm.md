---
title: Monitoring Azure virtual machines
description: Start here to learn how to monitor Azure virtual machines
ms.service: virtual-machines
ms.topic: article
ms.custom: subject-monitoring
ms.date: 11/15/2021
---

# Monitoring Azure virtual machines

When you have critical applications and business processes relying on Azure resources, you want to monitor those resources for their availability, performance, and operation. This article describes the monitoring data generated by Azure virtual machines and how you can use the features of [Azure Monitor](/azure/azure-monitor/overview) to analyze and alert on this data.

> [!NOTE]
> This article provides basic information for getting started monitoring an Azure virtual machine. For a complete guide to monitoring your complete environment of Azure and hybrid virtual machines, see [Monitor virtual machines with Azure Monitor](../azure-monitor/vm/monitor-virtual-machine.md).

## What is Azure Monitor?
[Azure Monitor](/azure/azure-monitor/overview) is a full stack monitoring service that provides a complete set of features to monitor your Azure resources. You don't need to directly interact with Azure Monitor though to perform a variety of monitoring tasks since its features are integrated into the Azure portal for Azure services that it monitors. If you're interested in a general overview of how Azure Monitor works with Azure resources, see [Monitoring Azure resources with Azure Monitor](../azure-monitor/essentials/monitor-azure-resource.md).

## Monitoring data

Azure virtual machines collect the same kinds of monitoring data as other Azure resources that are described in [Monitoring data from Azure resources](/azure/azure-monitor/insights/monitor-azure-resource#monitoring-data). See [Monitoring Azure virtual machines data reference](monitor-vm-reference.md) for detailed information on the metrics and logs metrics created by Azure virtual machines.

## Overview page
Start with the **Monitoring** tab on the **Overview** page for your virtual machine. This includes charts that show key health metrics such as average CPU and network utilization. Click on a duration to change the time range for the charts or click on a chart to open metrics explorer to drill down further or to create an alert rule. 

:::image type="content" source="media/monitor-vm/overview.png" lightbox="media/monitor-vm/overview.png" alt-text="Azure virtual machine overview page":::

## Activity log
The [Activity log](../azure-monitor/essentials/activity-log.md) shows you recent activity by the virtual machine including any configuration changes and when it was stopped and started. View the Activity log in the Azure portal, or create a diagnostic setting to send it to a Log Analytics workspace where you can view events over time or analyze them with other collected data.

:::image type="content" source="media/monitor-vm/activity-log.png" lightbox="media/monitor-vm/activity-log.png" alt-text="Activity log":::


## Collect guest metrics and logs
Azure Monitor starts collecting metric data for your virtual machine host automatically. To collect metrics from the guest operating system of the virtual machine though, you must install an agent. The Log Analytics agent installed when you enable [VM insights](#vm-insights) sends performance data to Azure Monitor Logs which allows you to create heartbeat alerts. See [Tutorial: Enable monitoring for Azure virtual machine](../azure-monitor/vm/tutorial-monitor-vm-enable.md) for a tutorial on enabling VM insights for a virtual machine.

Install the [Azure Monitor agent](../azure-monitor/agents/azure-monitor-agent-overview.md) to collect guest logs from your virtual machine and to send guest metrics to Azure Monitor Metrics. The simplest method to install and configure the Azure Monitor agent is to create a data collection rule that defines which data to collect and automatically installs the agent on any virtual machines that don't already have it. See [Tutorial: Collect guest logs and metrics from Azure virtual machine](../azure-monitor/vm/tutorial-monitor-vm-guest.md).


## VM insights
Some services in Azure have a customized monitoring experience in Azure Monitor that includes pre-built workbooks and other specialized features for that particular service. These experiences are called *insights*. 

VM insights is designed to monitor your entire set of virtual machines together in a single interface. When you start monitoring multiple virtual machines in your Azure environment, you should consider enabling VM insights for the following eatures:

- Simplified onboarding of Log Analytics agent and Dependency agent to enable monitoring of a virtual machine guest operating system and workloads.
- Pre-defined trending performance charts and workbooks that allow you to analyze core performance metrics from the virtual machine's guest operating system.
- Dependency map that displays processes running on each virtual machine and the interconnected components with other machines and external sources.

:::image type="content" source="media/monitor-vm/vminsights-01.png" lightbox="media/monitor-vm/vminsights-01.png" alt-text="VM insights performance view":::

:::image type="content" source="media/monitor-vm/vminsights-02.png" lightbox="media/monitor-vm/vminsights-02.png" alt-text="VM insights map view":::

> [!NOTE]
> When you add a virtual machine to VM insights, the [Log Analytics agent](../azure-monitor/agents/log-analytics-agent.md) is automatically installed. This will coexist with the Azure Monitor agent if it's also installed. When VM insights supports the Azure Monitor agent, then this will be the only agent required for all Azure Monitor features.

See [Enable Azure Monitor for single virtual machine or virtual machine scale set in the Azure portal](../azure-monitor/vm/vminsights-enable-portal.md) for quick steps to configure VM insights and enable monitoring for a virtual machine. See [Enable VM insights overview](../azure-monitor/vm/vminsights-enable-overview.md) for general information on enabling insights and different methods for onboarding virtual machines.

## Analyze metrics
Metrics are numerical values that describe some aspect of a system at a particular point in time. Platform metrics for the virtual machine host are collected automatically. While the **Overview** page includes the most common metrics, you can access others using metrics explorer.  This tool allows you to create charts from metric values and visually correlate trends. You can create also create a metric alert rule or pin a chart to an Azure dashboard.

:::image type="content" source="media/monitor-vm/metrics-explorer.png" lightbox="media/monitor-vm/metrics-explorer.png" alt-text="Metrics explorer":::

See [Monitoring Azure virtual machines data reference](monitor-vm-reference.md#metrics) for a list of the metrics that are available. You must have the [Azure Monitor agent installed](#collect-guest-metrics-and-logs) to view guest metrics from the virtual machine.


## Analyzing logs
Data in Azure Monitor Logs is stored in a Log Analytics workspace where it's separated into tables that each has its own set of unique properties. Analyze log data using [log queries](../azure-monitor/logs/get-started-queries.md) in [Log Analytics](../azure-monitor/logs/log-analytics-tutorial.md).

VM insights includes performance views that allow you to analyze guest performance data collected in Logs. See [How to query logs from VM insights](../azure-monitor/vm/vminsights-log-search.md) for details and sample queries for this data.


## Alerts
Azure Monitor alerts proactively notify you when important conditions are found in your monitoring data. They allow you to identify and address issues in your system before your customers notice them. You can set alerts on [metrics](/azure/azure-monitor/platform/alerts-metric-overview), [logs](/azure/azure-monitor/platform/alerts-unified-log), and the [activity log](/azure/azure-monitor/platform/activity-log-alerts). 

The following table lists common and recommended alert rules for AKS.

### Metric alert rules
The following table lists common metric alerts used for virtual machines. If you're not familiar with creating metric alert rules, see [Tutorial: Create a metric alert in Azure Monitor](../azure-monitor/alerts/tutorial-metric-alert.md).

| Type | Rule Name | Condition | Description  |
|:---|:---|:---|:---|
| Processor utilization | Host | Percentage CPU  | 
| Available memory      | Guest | Windows | Memory % Committed Bytes in Use   | 
|                       | Guest | Linux   | mem/available_percent             | 
| Available disk space  | Guest | Windows | \Logical Disk(_Total)% Free Space |
|                       | Guest | Linux   | disk/free_percent                 |


These alerts are also available as *Recommended alerts (Preview)* in the *Insights* area under *Monitoring* in the Azure portal.

### Log alert rules
If you're not familiar with creating log query alert rules, see [Tutorial: Create a log query alert in Azure Monitor](../azure-monitor/alerts/tutorial-metric-alert.md).

For common log alert rules, see the **Queries** in Log Analytics for **Resource type** of *Virtual machines* and type of **Alerts**. Examples of alert queries include the following:

- Not reporting VMs
- Windows failed logins
- Members added to security groups





## Next steps

- See [Azure virtual machine monitoring data reference](monitor-vm-reference.md) for a reference of the logs and metrics created by Azure virtual machines.
